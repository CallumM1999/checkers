<!DOCTYPE html>
<html lang="en">
    <head>
        <% include ../components/head %>
        <title>Profile | Checkers</title>
    </head>
    <body>
        <%- include('../components/header', { auth }); %>

        <div class="container">
            <div class="profile__container">
                <h1 class="profile__title">Profile</h1>

                <!-- <div class="profile__group">
                    <label class="profile__label" for="">Profile Picture</label>

                    <div class="profile__profile__container">
                        <img src="<%= img %>" alt="" class="profile__profile__picture" /> 

                        <div class="profile__profile__label">Update Profile Picture</div>
                    </div>

                    <button>Select File</button>
                </div> -->

                <div id="app__username">
                    <div class="profile__group">
                        <label class="profile__label" for="">Username</label>

                        <div class="profile__input__group">
                            <input
                                ref="username"
                                type="text"
                                class="profile__input"
                                data-value="<%= username %>"
                                value="<%= username %>"
                                v-model="username"
                                :disabled="saving"
                            />
                            <span class="profile__search" v-bind:class="loadingClass"></span>
                        </div>

                        <div class="profile__status" v-if="valid || invalid" v-bind:class="{invalid, error: available === false}" v-cloak>
                            <span v-if="available === true && !loading && valid"> {{ username }} is available </span>
                            <span v-else-if="available === false && !loading"> {{ username }} is taken </span>
                            <span v-else-if="!loading">
                                Invalid username
                            </span>
                        </div>

                        <button class="profile__button" disabled v-bind:disabled="unchanged" @click="save">Save</button>

                        <success-message :close="closeSuccessMessage" :message="successMessage" v-if="successMessage"></success-message>
                        <error-message :close="closeErrorMessage" :message="errorMessage" v-if="errorMessage"></error-message>
                    </div>
                </div>

                <div id="app__email">
                    <div class="profile__group">
                        <label class="profile__label" for="">Email</label>

                        <div class="profile__input__group">
                            <input
                                ref="email"
                                type="text"
                                class="profile__input"
                                data-value="<%= email %>"
                                value="<%= email %>"
                                v-model="email"
                                :disabled="saving"
                            />
                            <span class="profile__search" v-bind:class="loadingClass"></span>
                        </div>

                        <div class="profile__status" v-if="valid || invalid" v-bind:class="{ invalid, error: available === false }" v-cloak>
                            <span v-if="!loading && invalid">
                                Invalid email
                            </span>
                        </div>

                        <button class="profile__button" disabled v-bind:disabled="unchanged" @click="save">Save</button>

                        <success-message :close="closeSuccessMessage" :message="successMessage" v-if="successMessage"></success-message>
                        <error-message :close="closeErrorMessage" :message="errorMessage" v-if="errorMessage"></error-message>
                    </div>
                </div>

                <div id="app__password">
                    <div class="profile__group">
                        <label class="profile__label" for="">Password</label>

                        <div class="profile__input__group">
                            <input type="password" class="profile__input" v-model="passwordCurrent" :disabled="saving" placeholder="Current password" />

                            <input type="password" class="profile__input" v-model="passwordNew" :disabled="saving" placeholder="New Password" />

                            <input type="password" class="profile__input" v-model="passwordNewConf" :disabled="saving" placeholder="Confirm new password" />
                            <span class="profile__search" v-bind:class="loadingClass"></span>
                        </div>

                        <p v-if="saving" v-cloak>LOADING</p>

                        <div class="profile__status" v-if="!emptyNew" v-bind:class="{ invalid }" v-cloak>
                            <span v-if="!validPassword">Password doesn't meet the requirements</span>
                            <span v-else-if="!passwordsMatch">Passwords don't match</span>
                        </div>

                        <div class="form__row">
                            <password-rules
                                :password="passwordNew"
                                :show-validation="passwordNew !== ''"
                                :rules="passwordRules"
                                :show="passwordRulesActive"
                                :toggle="togglePasswordRules"
                            ></password-rules>
                        </div>

                        <success-message :close="closeSuccessMessage" :message="successMessage" v-if="successMessage"></success-message>
                        <error-message :close="closeErrorMessage" :message="errorMessage" v-if="errorMessage"></error-message>

                        <button class="profile__button" @click="save" type="submit" disabled :disabled="empty || !validPassword || !passwordsMatch">
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script src="/js/validator.bundle.js"></script>
        <script src="/js/vue.bundle.js"></script>
        <script src="/js/profile.bundle.js"></script>
    </body>
</html>
